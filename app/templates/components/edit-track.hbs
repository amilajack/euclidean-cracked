{{#audio-track-sampler
  sequence=sequence
  directory=directory
  trackId=track.id
  filename=track.filename
  gain=track.gain
  outputNodeSelector="#master-compressor"
  as |sampler|
}}
  {{ui-step-sequencer
    sequence=sequence
    stepIndex=sampler.stepIndex
  }}
{{/audio-track-sampler}}

{{ui-slider
  max=1
  min=0
  size=gainSliderSize
  step=0.01
  class='gain-slider'
  onChangeValue=(action "updateSequenceParam" track 'gain')
  value=track.gain
}}

<div class="ui-controls">
  <div class="btn-group btn-group-xs interface-switches" role="group" aria-label="toggle-interface">
    <button {{action 'switchInterface' 'sampler'}} type="button" class="btn btn-default sampler">Sampler</button>
    <button {{action 'switchInterface' 'rhythm'}} type="button" class="btn btn-default rhythm">Euclidean Rhythm</button>
    <button {{action 'switchInterface' 'signal'}} type="button" class="btn btn-default signal">Signal</button>
  </div>

  {{#if (eq visibleInterface 'rhythm' )}}
    <div class="sequence-dials">
      {{#ui-dial
        max=16
        step=1
        onChangeValue=(action "updateSequenceParam" track 'hits')
        value=track.hits
      }}
      <dl>
        <dt>hits</dt>
        <dd>{{track.hits}}</dd>
      </dl>
      {{/ui-dial}}

      {{#ui-dial
        max=16
        step=1
        onChangeValue=(action "updateSequenceParam" track 'steps')
        value=track.steps
      }}
        <dl>
          <dt>steps</dt>
          <dd>{{track.steps}}</dd>
        </dl>
      {{/ui-dial}}

      {{#ui-dial
        max=16
        step=1
        onChangeValue=(action "updateSequenceParam" track 'offset')
        value=track.offset
      }}
        <dl>
          <dt>offset</dt>
          <dd>{{track.offset}}</dd>
        </dl>
      {{/ui-dial}}
    </div>
  {{/if}}

  {{#if (eq visibleInterface 'sampler')}}
    <div class="sampler-controls">
      {{ui-select
        choices=filenames
        onChangeValue=(action "updateFilename" track)
        value=track.filename
      }}
    </div>
  {{/if}}

  {{#if (eq visibleInterface 'signal')}}

    <p>write custom <a href="https://billorcutt.github.io/i_dropped_my_phone_the_screen_cracked/" target="_blank">cracked</a> script (WIP)</p>
    <form {{action 'submitCode' on='submit'}} class="signal-controls">
      <textarea name="name" rows="6" cols="35" oninput={{action (mut signalCode) value='target.value'}}></textarea>

        <ul class="code-info">
          <li>
            <small>this track's sampler node</small>
            <code>#sampler-{{track.id}}</code>
          </li>
        </ul>

      <button class="run-code-btn" type="submit" name="button">run</button>
    </form>

  {{/if}}
</div>

{{euclidean-sequence
  hits=track.hits
  steps=track.steps
  offset=track.offset
  onCalculateSequence=(action "setTrackSequence" track)
}}

<button
  type='delete'
  class='btn btn-danger delete-track'
  {{action 'deleteTrack' track}}
>
  <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
</button>

{{yield}}
